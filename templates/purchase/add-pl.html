{% extends "base.html" %}

{% block angular %}
	<script type="text/javascript" src="/statics/js/angular.min.js"></script>
	<script type="text/javascript" src="/statics/js/angular-route.min.js"></script>	

	<script type="text/javascript" src="/statics/js/bootstrap-multiselect.js"></script>
	<link rel="stylesheet" href="/statics/css/bootstrap-multiselect.css" type="text/css"/>
{% endblock angular %}

{% block content %}
<style>
.contact_box, .item_box, .job_box {
	position: relative;
}
table#sold_to_contact_details, table#ship_to_contact_details, table#customer_broker_contact_details {
	margin-top: 10px;
}
table#sold_to_contact_details th, table#ship_to_contact_details th, table#customer_broker_contact_details th{
	background-color: #83AD9E;
}
table > thead {
	background-color: #83AD9E;
}
table > tbody {
	background-color: #FFF;
}
#ship_to_contact_list, #sold_to_contact_list, #items_list, #customer_broker_contact_list, #job_list {
	position: absolute;
	top: 35px;
	left: 0px;
	background-color: #DDD;
	z-index: 1000;
	/*border: 1px solid #000;*/
	-webkit-box-shadow: 0px 0px 10px 0px rgba(50, 50, 50, 0.75);
	-moz-box-shadow:    0px 0px 10px 0px rgba(50, 50, 50, 0.75);
	box-shadow:         0px 0px 10px 0px rgba(50, 50, 50, 0.75);
}
.sold_to_contact tbody tr:hover, .ship_to_contact tbody tr:hover, .customer_broker_contact tbody tr:hover {
	background-color: #616183;
}
table#items_list {
	width: 940px;
}
#items_list tbody tr:hover{
	background-color: #CCC;
}
.bg-hello {
	background-color: #777;
}
p.item_desc {
	min-height: 34px;
	margin-bottom: 0px;
	padding: 5px;
}
.glyphicon {
	color: red;
}
#job-details {
	margin-top: 5px;
	margin-bottom: 0px !important;
}
</style>
<div class="container-fluid shadow4 main-body" ng-app="plApp">

<section class="row " ng-controller="AddPLController">
	
	<form action="/purchase/add-pl/" method="POST" enctype="multipart/form-data">{% csrf_token %}
	<div class="col-md-12">
		<div class="panel panel-primary">
			<div class="panel-heading">
		    	<h4>Add Packing List</h4>
		  	</div>
		  	<div class="panel-body">

			  	{% include "purchase/partials/add-pl-form.html" %}			  		
				
			</div>
		</div>
	</div>
	

	</form>

</section>

</div>


<script type="text/javascript">
(function(){
$(".datepicker").datepicker();
$("a.close").on("click", function(){
	$(this).closest('table').hide();
});

var plApp = angular.module("plApp", [], function ($interpolateProvider) {
        $interpolateProvider.startSymbol("{[{");
        $interpolateProvider.endSymbol("}]}");
});
plApp.filter('googleSearchFilter', function(){
    return function(items, token) {
        
        if(token != undefined && token != "") {
            var output=[];
            var filter_output = [];
            output = items;
            // console.log(output);
            
            var searchArr = token.split(" ");

            for(var j=0; j<searchArr.length; j++) {

                for(var i=0; i<output.length; i++) {
                    // console.log(output[i]);
                    var search_str = output[i].search_string;
                    // We can remove this if statement when all is updated.
                    // console.log(search_str);
                    if (search_str != null) {
                        var n = search_str.search(new RegExp(searchArr[j], "i"));    
                        // console.log('search_str is not null');
                    }
                    // console.log(n);
                    if(n != -1) {
                        filter_output.push(output[i]);
                    }

                }
                output = filter_output;
                filter_output = [];  
            }
            
            return output;

        } else {
            return items;
        }   
    }
});
plApp.controller('AddPLController',['$scope', '$http','$compile', function ($scope, $http, $compile) {
	
	$scope.init = function() {


		$http({method: 'GET', url: "/inventory/items/"}).
            success(function(data, status, headers, config) {
                // console.log(data);
                $scope.items = data;
            });

        $http({method: 'GET', url: "/contacts/list/"}).
            success(function(data, status, headers, config) {
                // console.log(data);
                $scope.contacts = data;
            });

        $http({method: 'GET', url: "/schedule/all-jobs/"}).
            success(function(data, status, headers, config) {
            	console.log("jobs");
                console.log(data);
                $scope.schedule_jobs = data;
            });


        $("#sold_to_contact_list").hide();
        $("#sold_to_contact_details").hide();

        $("#ship_to_contact_list").hide();
        $("#ship_to_contact_details").hide();

        $("#customer_broker_contact_list").hide();
        $("#customer_broker_contact_details").hide();

        $("#job_list").hide();
        $("#job-details").hide();

        $("#items_list").hide();
        
        // $("#ship-to-container").hide();
	};

	$scope.init();

	$scope.$watch('search_job', function (newValue, oldValue) {
        if(newValue != undefined) {
        	if(newValue.length > 1) {
        		$("#job_list").show();
        		console.log(newValue);
        	} else {
        		$("#job_list").hide();
        	}
        }
    });

    $scope.$watch('search_sold_to', function (newValue, oldValue) {
        if(newValue != undefined) {
        	if(newValue.length > 1) {
        		$("#sold_to_contact_list").show();
        		console.log(newValue);
        	} else {
        		$("#sold_to_contact_list").hide();
        	}
        }
    });

    $scope.$watch('search_ship_to', function (newValue, oldValue) {
        if(newValue != undefined) {
        	if(newValue.length > 1) {
        		$("#ship_to_contact_list").show();
        		console.log(newValue);
        	} else {
        		$("#ship_to_contact_list").hide();
        	}
        } 
    });

    $scope.$watch('search_customer_broker', function (newValue, oldValue) {
        if(newValue != undefined) {
        	if(newValue.length > 1) {
        		$("#customer_broker_contact_list").show();
        		console.log(newValue);
        	} else {
        		$("#customer_broker_contact_list").hide();
        	}
        } 
    });

	$scope.selectShipTo = function(con) {
		$("#ship_to_contact_list").hide();
		$scope.search_ship_to = ""
		$scope.ship_to_contact = con;
		$("#id_ship_to").val(con.id);
		$("#ship_to_contact_details").show();


	};
    $scope.selectSoldTo = function(con) {
		$("#sold_to_contact_list").hide();
		$scope.search_ship_to = ""
		$scope.sold_to_contact = con;
		$("#id_sold_to").val(con.id);
		$("#sold_to_contact_details").show();


	};

	$scope.selectCustomerBroker = function(con) {
		$("#customer_broker_contact_list").hide();
		$scope.search_customer_broker = ""
		$scope.customer_broker_contact = con;
		// console.log(con);
		$("#id_customer_broker").val(con.id);
		$("#customer_broker_contact_details").show();
	}

	$scope.selectJob = function(job){
		$("#job_list").hide();
		$scope.search_job = "";
		$scope.schedule_job = job;
		$("#id_job_number").val(job.id);
		$("#job-details").show();

	}

}]);

})(jQuery)
</script>
{% endblock content %}
	
